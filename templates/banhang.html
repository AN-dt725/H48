<!DOCTYPE html>
<html lang="vi">
<head>
  <meta name="viewport" content="width=device-width, initial-scale=1">

    <meta charset="UTF-8">
    <title>🛒 Bắt đầu bán hàng</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
    <style>
        body { background-color: #f8f9fa; }
        .suggestion-item:hover { background-color: #e9f5ff; cursor: pointer; }
        .card-product { box-shadow: 0 3px 8px rgba(0,0,0,0.1); }
    </style>
</head>
<body class="bg-light">
<div class="container py-5 px-4">
    <div class="d-flex justify-content-between align-items-center mb-5">
        <h1 class="text-primary display-6">🛒 Bắt đầu bán hàng</h1>
        <a href="/" class="btn btn-lg btn-outline-secondary btn-lg">← Trang chủ</a>
    </div>
    <div class="mb-4">
        <input type="text" id="search-input" class="form-control form-control-lg form-control form-control-lg-lg" placeholder="🔍 Nhập tên hoặc loại sản phẩm...">
        <div id="suggestions" class="list-group position-relative"></div>
    </div>
    <div id="product-detail" class="mb-5"></div>
    <div class="bg-white rounded p-4 shadow">
        <h3 class="mb-4">🧺 Giỏ hàng</h3>
        <ul id="cart-list" class="list-group mb-3 fs-5"></ul>
        <div class="d-flex justify-content-between align-items-center">
            <h4 class="text-danger">Tổng tiền: <span id="total-price">0k</span></h4>
            <button class="btn btn-lg btn-outline-danger" onclick="clearCart()">🗑️ Xoá tất cả</button>
        </div>
    </div>
</div>
<script>
    let suggestionsBox = document.getElementById('suggestions');
    let searchInput = document.getElementById('search-input');
    let productDetail = document.getElementById('product-detail');
    let cartList = document.getElementById('cart-list');
    let totalPriceTag = document.getElementById('total-price');
    let cart = [];

    searchInput.addEventListener('input', async () => {
        let term = searchInput.value.trim();
        suggestionsBox.innerHTML = '';
        if (term.length > 0) {
            let res = await fetch(`/autocomplete?term=${encodeURIComponent(term)}`);
            let data = await res.json();
            data.forEach(item => {
                let div = document.createElement('div');
                div.className = 'list-group-item fs-5 suggestion-item';
                div.textContent = `${item.name} - ${item.type} - ${item.price}`;
                div.onclick = () => selectProduct(item);
                suggestionsBox.appendChild(div);
            });
        }
    });

    function selectProduct(item) {
        suggestionsBox.innerHTML = '';
        productDetail.innerHTML = `
            <div class="card card-product p-4">
                <h4>${item.name}</h4>
                <p class="mb-1">Loại: <strong>${item.type}</strong></p>
                <p class="mb-3">Giá: <strong class="text-success">${item.price}</strong></p>
                <button class="btn btn-lg btn-success btn-lg" onclick='addToCart(${JSON.stringify(item)})'>➕ Thêm vào giỏ</button>
            </div>
        `;
    }

    function addToCart(item) {
        cart.push(item);
        renderCart();
    }

    function removeFromCart(index) {
        cart.splice(index, 1);
        renderCart();
    }

    function clearCart() {
        cart = [];
        renderCart();
    }

    function renderCart() {
        cartList.innerHTML = '';
        let total = 0;
        cart.forEach((item, idx) => {
            let li = document.createElement('li');
            li.className = 'list-group-item d-flex justify-content-between align-items-center';
            li.innerHTML = `${item.name} - ${item.price} <button class="btn btn-lg btn-danger btn-sm" onclick='removeFromCart(${idx})'>&times;</button>`;
            cartList.appendChild(li);
            let num = parseInt(item.price.toLowerCase().replace(/[^0-9]/g, ''));
            if (!isNaN(num)) total += num;
        });
        totalPriceTag.textContent = `${total}k`;
    }
</script>
</body>
</html>